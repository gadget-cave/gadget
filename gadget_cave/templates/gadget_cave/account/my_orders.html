{% extends "gadget_cave/base.html" %}
{% block title %}My Orders{% endblock %}

{% block content %}
<h1>My Orders</h1>

{% if orders %}
    {% for order in orders %}
    <div class="card mb-3">
        <div class="card-header">
            Order ID: <strong>{{ order.id }}</strong> | Placed on: {{ order.created|date:"F d, Y H:i" }} | Status: {% if order.paid %}<span class="badge badge-success">Paid</span>{% else %}<span class="badge badge-warning">Pending Payment</span>{% endif %}
        </div>
        <div class="card-body">
            <h5>Shipping Address:</h5>
            <p>{{ order.first_name }} {{ order.last_name }}<br>
               {{ order.address }}<br>
               {{ order.city }}, {{ order.postal_code }}<br>
               Email: {{ order.email }}<br>
               Phone: {{ order.phone|default:"N/A" }}
            </p>
            <h5>Items:</h5>
            <ul class="list-group list-group-flush">
                {% for item in order.items.all %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <a href="{{ item.product.get_absolute_url }}">{{ item.product.name }}</a>
                        <br><small class="text-muted">Price: ₹{{ item.price }} x Quantity: {{ item.quantity }}</small>
                    </div>
                    <span class="badge badge-primary badge-pill">₹{{ item.get_cost }}</span>
                </li>
                {% endfor %}
            </ul>
            <h5 class="mt-3 text-right">Total Cost: <strong>₹{{ order.get_total_cost }}</strong></h5>
            {% if order.upi_transaction_id %}
                <p class="text-right text-muted">UPI Transaction ID: {{ order.upi_transaction_id }}</p>
            {% endif %}
        </div>
    </div>
    {% endfor %}
{% else %}
    <p>You haven't placed any orders yet.</p>
    <p><a href="{% url 'gadget_cave:home' %}" class="btn btn-primary">Start Shopping</a></p>
{% endif %}
{% endblock %}